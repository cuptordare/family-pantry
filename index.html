<!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8" />    <meta name="viewport" content="width=device-width, initial-scale=1.0" />    <title>Family Pantry</title>    <link rel="icon" href="favicon.ico" type="image/x-icon" />    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">    <link rel="manifest" href="manifest.json">    <!-- Styles: Base -->    <!-- Styles: Layout -->    <!-- Styles: Components -->    <!-- Styles: Views --><style>
/* styles/base.css */
/* ==========================================================================   Base Styles   Core styles, CSS variables, and utility classes   ========================================================================== */:root {    --app-bg-color: #fff;    --app-text-color: #333;    --app-primary-color: #6200ee;    --app-primary-light: rgba(98, 0, 238, 0.1);    --app-border-color: #eee;    --app-muted-color: #999;    --app-error-color: #d32f2f;    --app-success-color: #388e3c;}body {    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;    font-size: 16px;    margin: 0;    padding: 0;    background: var(--app-bg-color);    color: var(--app-text-color);    min-height: 100vh;}#bg {    position: fixed;    top: 0;    left: 0;    right: 0;    height: 100svh;    z-index: -1;    transition: opacity 0.2s;}#app {    position: relative;    z-index: 1;    max-width: 768px;    margin: 0 auto;    transition: opacity 0.3s ease;}.fade-out {    opacity: 0;}.fade-in {    opacity: 1;}svg {    display: block;    pointer-events: none;    fill: currentColor;    width: 18px;    height: 18px;}a {    color: var(--app-primary-color);}button {    font-family: inherit;    padding: 8px 16px;    border: none;    border-radius: 4px;    background: var(--app-primary-color);    color: #fff;    cursor: pointer;    transition: opacity 0.2s;    &:hover {        opacity: 0.9;    }    &:active {        opacity: 0.8;    }    &.secondary {        background-color: #f8f8f8;        color: inherit;    }}.button--icon-only {    color: var(--app-muted-color);    background: none;    border: none;    cursor: pointer;    padding: 8px;}.view-content {    padding-bottom: 20px;}/* ---------- Loading Spinner ---------- */[data-loading]::before,[data-loading]::after {    content: "";    position: fixed;    inset: 0;    pointer-events: none;    z-index: 9999;}[data-loading]::before {    background: rgba(0, 0, 0, 0.35);    pointer-events: auto;}[data-loading]::after {    width: 48px;    height: 48px;    border: 4px solid rgba(255, 255, 255, 0.35);    border-top-color: #fff;    border-radius: 50%;    position: fixed;    top: 50%;    left: 50%;    transform: translate(-50%, -50%);    animation: spin 0.9s linear infinite;}@keyframes spin {    to {        transform: translate(-50%, -50%) rotate(360deg);    }}/* ---------- Shake Animation ---------- */@keyframes shake {    0%,    100% {        transform: translateX(0);    }    10%,    30%,    50%,    70%,    90% {        transform: translateX(-5px);    }    20%,    40%,    60%,    80% {        transform: translateX(5px);    }}.shake {    animation: shake 0.5s ease-in-out;}
/* styles/layout/sidebar.css */
/* ==========================================================================   Sidebar / Hamburger Menu   ========================================================================== */.hamburger-btn {    position: relative;    cursor: pointer;    color: var(--app-muted-color);    padding: 0 4px;    margin-right: 10px;    background: none;    border: none;}.hamburger-btn svg {    display: block;    width: 24px;    height: 24px;    pointer-events: none;}.sidebar-overlay {    position: fixed;    inset: 0;    background: rgba(0, 0, 0, 0.45);    opacity: 0;    pointer-events: none;    transition: opacity 0.25s ease;    z-index: 999;}.sidebar-overlay.open {    opacity: 1;    pointer-events: auto;}.sidebar {    position: fixed;    top: 0;    height: 100%;    width: 280px;    background: #fff;    transition: transform 0.3s ease;    z-index: 1000;    display: flex;    flex-direction: column;    padding: 24px;    box-sizing: border-box;}.sidebar.left {    left: 0;    transform: translateX(-100%);}.sidebar.right {    right: 0;    transform: translateX(100%);}.sidebar.open {    box-shadow: 2px 0 12px rgba(0, 0, 0, 0.15);    transform: translateX(0);}.sidebar .user {    display: flex;    align-items: center;    margin-bottom: 20px;}.sidebar .user-bubble {    display: block;    width: fit-content;    background-color: var(--app-primary-color);    color: #fff;    border-radius: 8px;    text-transform: capitalize;    padding: 2px 5px;    font-size: 32px;    margin-right: 10px;}.sidebar .user-nickname {    font-style: italic;    color: var(--app-muted-color);}.sidebar a {    display: flex;    align-items: center;    text-decoration: none;    color: #222;    font-size: 1rem;    padding: 10px 0;    margin: 0 -24px;}.sidebar a[data-active] {    background-color: #f8f8f8;}.sidebar a svg {    display: block;    width: 24px;    height: 24px;    pointer-events: none;    fill: currentColor;    margin: 0 15px 0 20px;}/* styles/layout/titlebar.css */
/* ==========================================================================   Title Bar   ========================================================================== */.view-title-bar {    display: flex;    align-items: center;    margin-bottom: 20px;    padding: 5px;}.view-title {    margin: 0 auto 0 0;    font-size: 24px;}.view-menu-item {    display: block;    color: inherit;    padding: 6px;    border-radius: 8px;    margin-left: 5px;    transition: all 0.3s;}.view-menu-item[data-active] {    background-color: var(--app-border-color);}/* styles/layout/bottomMenu.css */
/* ==========================================================================   Bottom Menu (Tabs)   ========================================================================== */.bottom-menu {    position: fixed;    bottom: 0;    left: 0;    width: 100vw;    background: var(--app-bg-color);    display: flex;    border-top: 1px solid var(--app-border-color);    box-shadow: 0 -2px 12px rgba(0, 0, 0, 0.06);    z-index: 100;    height: 64px;}.bottom-menu .menu-tab {    flex: 1;    padding: 0;    display: flex;    flex-direction: column;    align-items: center;    justify-content: center;    cursor: pointer;    font-size: 15px;}.bottom-menu .menu-tab--active {    background-color: var(--app-primary-color);    color: #fff;}/* Add padding when bottom menu is present */.pantry-view .view-content {    padding-bottom: 80px;}/* styles/components/modal.css */
/* ==========================================================================   Modal   ========================================================================== */.modal {    position: fixed;    top: 0;    left: 0;    right: 0;    bottom: 0;    width: 100vw;    height: 100vh;    background: rgba(0, 0, 0, 0.4);    display: none;    justify-content: center;    align-items: center;    z-index: 1000;}.modal.show {    display: flex;}.modal-shell {    position: fixed;    left: 50%;    transform: translateX(-50%);    width: 90%;    max-width: 400px;    background: white;    border-radius: 8px;    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);    transition: transform 0.3s ease, opacity 0.3s ease;    opacity: 0;}.modal-shell .modal-content {    max-height: 80vh;    overflow: auto;}/* Bottom slide */.modal-shell.bottom {    bottom: 0;    border-bottom-left-radius: 0;    border-bottom-right-radius: 0;    transform: translate(-50%, 100%);}.modal-shell.bottom .modal-content {    padding: 20px 20px 40px;}.modal-shell.bottom.show {    transform: translate(-50%, 0);    opacity: 1;}/* Top slide */.modal-shell.top {    top: 0;    border-top-left-radius: 0;    border-top-right-radius: 0;    transform: translate(-50%, -100%);}.modal-shell.top .modal-content {    padding: 40px 20px 20px;}.modal-shell.top.show {    transform: translate(-50%, 0);    opacity: 1;}/* styles/components/cards.css */
/* ==========================================================================   Wants Cards   ========================================================================== */.wants-title {    font-weight: 500;    background-color: #f8f8f8;    padding: 5px;    border-top: solid 1px var(--app-border-color);    display: flex;    align-items: center;}.wants-title svg {    margin-right: 5px;}.wants-card {    display: flex;    padding: 5px;    border-top: solid 1px var(--app-border-color);}.wants-card .wants-card__body {    flex: 1 1 auto;}.wants-card .wants-card__list {    color: var(--app-muted-color);    font-size: 14px;}.wants-card .wants-card__actions {    flex: none;}.wants-card .wants-user {    color: var(--app-text-color);}.wants-card:last-child {    border-bottom: solid 1px var(--app-border-color);}/* styles/components/selection.css */
/* ==========================================================================   Selection Modal / Checkboxes   ========================================================================== */.select-option {    display: flex;    align-items: center;    cursor: pointer;    user-select: none;    margin-bottom: 10px;}.select-option input[type="checkbox"] {    display: none;}.select-option .select-option-checkmark {    width: 24px;    height: 24px;    min-width: 24px;    border-radius: 8px;    border: 2px solid #ccc;    margin-right: 12px;    transition: all 0.2s;    background: #fff;    position: relative;}.select-option input:checked + .select-option-checkmark {    background: var(--app-primary-color);    border-color: var(--app-primary-color);}.select-option .select-option-checkmark::after {    content: "";    position: absolute;    display: none;}.select-option input:checked + .select-option-checkmark::after {    display: block;    left: 7px;    top: 2px;    width: 6px;    height: 12px;    border: solid #fff;    border-width: 0 3px 3px 0;    transform: rotate(45deg);}.select-option .select-option-content {    flex: 1;}.select-option input:checked ~ .select-option-content {    color: var(--app-primary-color);}.selection-modal input[type="search"] {    width: 100%;    box-sizing: border-box;    border: solid 2px #ccc;    border-radius: 3px;    padding: 5px 8px;    font-size: 18px;}/* styles/views/home.css */
/* ==========================================================================   Home View (Login Screen)   ========================================================================== */.home-view {    min-height: 100vh;    display: flex;    flex-direction: column;    padding: 20px;    box-sizing: border-box;}.home-hero {    flex: 1;    display: flex;    flex-direction: column;    align-items: center;    justify-content: center;    padding: 40px 20px;}.home-logo {    width: 100px;    height: 100px;    background: var(--app-primary-color);    border-radius: 24px;    display: flex;    align-items: center;    justify-content: center;    margin-bottom: 24px;    box-shadow: 0 8px 24px rgba(98, 0, 238, 0.3);}.home-logo svg {    fill: #fff;}.home-title {    margin: 0 0 8px;    font-size: 32px;    font-weight: 700;    color: var(--app-text-color);    text-align: center;}.home-subtitle {    margin: 0;    font-size: 16px;    color: var(--app-muted-color);    text-align: center;}.home-card {    background: #fff;    border-radius: 16px;    padding: 24px;    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);    margin-bottom: 20px;}.home-form {    display: flex;    flex-direction: column;    gap: 16px;}.home-form__field {    display: flex;    flex-direction: column;}.home-form__label {    font-size: 14px;    font-weight: 500;    color: var(--app-muted-color);    margin-bottom: 8px;}.home-form__input {    padding: 14px 16px;    font-size: 18px;    border: 2px solid var(--app-border-color);    border-radius: 12px;    outline: none;    transition: border-color 0.2s, box-shadow 0.2s;    text-transform: uppercase;    letter-spacing: 2px;    text-align: center;}.home-form__input:focus {    border-color: var(--app-primary-color);    box-shadow: 0 0 0 3px var(--app-primary-light);}.home-form__input.error {    border-color: var(--app-error-color);    box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.1);}.home-form__input::placeholder {    text-transform: none;    letter-spacing: normal;    color: #ccc;}.home-form__error {    margin-top: 8px;    font-size: 14px;    color: var(--app-error-color);    text-align: center;}.home-form__button {    display: flex;    align-items: center;    justify-content: center;    gap: 8px;    padding: 16px 24px;    font-size: 16px;    font-weight: 600;    background: var(--app-primary-color);    color: #fff;    border: none;    border-radius: 12px;    cursor: pointer;    transition: all 0.2s;}.home-form__button:hover {    background: #5000d4;    transform: translateY(-1px);    box-shadow: 0 4px 12px rgba(98, 0, 238, 0.3);}.home-form__button:active {    transform: translateY(0);}.home-form__button svg {    transition: transform 0.2s;}.home-form__button:hover svg {    transform: translateX(4px);}.home-footer {    text-align: center;    padding: 20px;}.home-footer p {    margin: 0;    font-size: 13px;    color: var(--app-muted-color);}/* styles/views/store.css */
/* ==========================================================================   Store View   ========================================================================== */.store-section {    margin-bottom: 10px;}.store-items {    border-top: 1px solid var(--app-border-color);}.store-empty {    padding: 15px 10px;    color: var(--app-muted-color);    font-style: italic;}.store-item {    padding: 12px 10px;    border-bottom: 1px solid var(--app-border-color);    margin-bottom: 0;}.store-item .store-item__content {    display: flex;    flex-direction: column;}.store-item .store-item__users {    font-size: 13px;    color: var(--app-muted-color);}/* Purchased Button (Floating Action) */.purchased-btn-container {    position: fixed;    bottom: 20px;    left: 50%;    transform: translateX(-50%) translateY(100px);    opacity: 0;    pointer-events: none;    transition: all 0.3s ease;    z-index: 99;}.purchased-btn-container.visible {    transform: translateX(-50%) translateY(0);    opacity: 1;    pointer-events: auto;}.purchased-btn {    display: flex;    align-items: center;    gap: 8px;    padding: 12px 24px;    background: var(--app-primary-color);    color: #fff;    border: none;    border-radius: 30px;    font-size: 16px;    font-weight: 500;    cursor: pointer;    box-shadow: 0 4px 12px rgba(98, 0, 238, 0.4);    transition: all 0.2s;}.purchased-btn svg {    fill: currentColor;}.purchased-btn:active {    transform: scale(0.95);}/* styles/views/todo.css */
/* ==========================================================================   Todo View   ========================================================================== */.todo-list {    padding: 10px;    min-height: 100px;}.todo-empty {    color: var(--app-muted-color);    font-style: italic;    padding: 20px;    text-align: center;}.todo-item {    display: flex;    align-items: center;    padding: 12px 8px;    border-bottom: 1px solid var(--app-border-color);    background: #fff;    transition: all 0.2s;    touch-action: none;}.todo-item.dragging {    opacity: 0.8;    background: #f0f0f0;    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);    z-index: 100;}.todo-item.drag-above {    border-top: 2px solid var(--app-primary-color);}.todo-item.drag-below {    border-bottom: 2px solid var(--app-primary-color);}.todo-item:last-child {    border-bottom: none;}.todo-item__handle {    cursor: grab;    margin-right: 8px;    touch-action: none;}.todo-item__handle:active {    cursor: grabbing;}.todo-item__handle svg {    display: block;}.todo-item__text {    flex: 1;}.todo-add {    display: flex;    padding: 10px;    gap: 10px;    background: #f8f8f8;    border-bottom: 1px solid var(--app-border-color);}.todo-add input {    flex: 1;    padding: 8px 12px;    border: 2px solid #ccc;    border-radius: 4px;    font-size: 16px;}.todo-add button {    padding: 8px 16px;}/* styles/views/schedule.css */
/* ==========================================================================   Schedule View   ========================================================================== */.schedule-day {    margin-bottom: 10px;}.schedule-day__header {    font-weight: 600;    background-color: #f8f8f8;    padding: 8px 10px;    border-top: solid 1px var(--app-border-color);    display: flex;    align-items: center;    justify-content: space-between;}.schedule-event {    display: flex;    align-items: center;    padding: 8px 10px;    border-top: 1px solid var(--app-border-color);}.schedule-event__time {    color: var(--app-primary-color);    font-size: 14px;    min-width: 120px;}.schedule-event__title {    flex: 1;}.schedule-event__actions {    display: flex;    gap: 5px;}.schedule-empty {    padding: 10px;    color: var(--app-muted-color);    font-style: italic;    border-top: 1px solid var(--app-border-color);}</style>
</head><body>    <div id="bg"></div>    <main id="app"></main>    <!-- Storage Adapters -->    <script>
/** * SessionStorage Adapter *  * Simple adapter that stores all data in browser sessionStorage. * Good for development and small personal projects. */const lazyLoadedKeys = new Set();window.SessionStorageAdapter = {    async get(key) {        if (!lazyLoadedKeys.has(key)) {            // Simulate network delay            await window.AppHelpers.delay(100);        }        const json = sessionStorage.getItem(key);        if (json) {            lazyLoadedKeys.add(key);            return JSON.parse(json);        }        return null;    },    async set(key, value) {        // Simulate network delay        await window.AppHelpers.delay(100);        sessionStorage.setItem(key, JSON.stringify(value));    },    async delete(key) {        // Simulate network delay        await window.AppHelpers.delay(100);        sessionStorage.removeItem(key);        lazyLoadedKeys.removeItem(key);    },};</script>    <script>
/** * Google Sheets Adapter *  * Stores data in Google Sheets via Google Apps Script Web App. * Uses localStorage as a cache layer for performance. *  * Google Sheets cell limit: * - 50,000 characters per cell * - 10 million total cells *  * Google Apps Script Web Apps limits (Free Tier): * - Max execution time per request: ~30 seconds * - Daily total execution time: 90 minutes/day * - URLFetch calls: 20,000/day * - Spreadsheet reads: 20,000/day * - Spreadsheet writes: 20,000/day * - Concurrent executions: ~30-50 (unofficial) */window.GoogleSheetsAdapter = {    async get(key) {        // Try cache first        const cached = localStorage.getItem(key);        if (cached) {            return JSON.parse(cached);        }        // Fetch from remote        try {            const res = await fetch(window.AppSecrets.APP_DATA_URL, {                method: "POST",                body: JSON.stringify({                    secret: window.AppSecrets.APP_DATA_SECRET,                    action: "get",                    id: key                })            });            const data = await res.json();            // Cache the result            if (data) {                localStorage.setItem(key, JSON.stringify(data));            }            return data;        }        catch (error) {            console.error('GoogleSheetsAdapter.get error:', error);            throw error;        }    },    async set(key, value) {        // Update cache immediately        localStorage.setItem(key, JSON.stringify(value));        // Sync to remote        try {            await fetch(window.AppSecrets.APP_DATA_URL, {                method: "POST",                body: JSON.stringify({                    secret: window.AppSecrets.APP_DATA_SECRET,                    action: "set",                    id: key,                    data: value                })            });        }        catch (error) {            console.error('GoogleSheetsAdapter.set error:', error);            throw error;        }    },    async delete(key) {        // Remove from cache        localStorage.removeItem(key);        // Delete from remote        try {            await fetch(window.AppSecrets.APP_DATA_URL, {                method: "POST",                body: JSON.stringify({                    secret: window.AppSecrets.APP_DATA_SECRET,                    action: "delete",                    id: key                })            });        }        catch (error) {            console.error('GoogleSheetsAdapter.delete error:', error);            throw error;        }    },};</script>    <script>
/** * Storage Adapter Interface *  * To switch storage backends, change the ACTIVE_ADAPTER in app.config.js * and implement a new adapter following this interface. *  * Each adapter must implement: *   - get(key): Promise<any> - Retrieve data by key *   - set(key, value): Promise<void> - Store data by key *   - delete(key): Promise<void> - Delete data by key *   - getAll(): Promise<object> - Get all stored data (optional) */window.StorageAdapter = {    _adapter: null,    /**     * Initialize the storage adapter based on config     */    init() {        const adapterType = window.AppConfig.STORAGE_ADAPTER || 'sessionStorage';        switch (adapterType) {            case 'googleSheets':                this._adapter = window.GoogleSheetsAdapter;                break;            case 'sessionStorage':            default:                this._adapter = window.SessionStorageAdapter;                break;        }        console.log(`Storage adapter initialized: ${adapterType}`);    },    /**     * Get data by key     * @param {string} key      * @returns {Promise<any>}     */    async get(key) {        if (!this._adapter) this.init();        return this._adapter.get(key);    },    /**     * Set data by key     * @param {string} key      * @param {any} value      * @returns {Promise<void>}     */    async set(key, value) {        if (!this._adapter) this.init();        return this._adapter.set(key, value);    },    /**     * Delete data by key     * @param {string} key      * @returns {Promise<void>}     */    async delete(key) {        if (!this._adapter) this.init();        return this._adapter.delete(key);    },    /**     * Clear cache (for adapters that use caching)     * @param {string} key      */    clearCache(key) {        localStorage.removeItem(key);    },};</script>    <!-- Config -->    <script>
window.AppConfig = {    APP_NAME: 'Family Pantry',    APP_SHORT_NAME: 'FP',    /**     * Storage adapter to use: 'sessionStorage' or 'googleSheets'     *      * - sessionStorage: Data stored locally in browser (good for dev/testing)     * - googleSheets: Data stored in Google Sheets via Apps Script     *      * To add a new adapter:     * 1. Create src/storage/myAdapter.js implementing get/set/delete     * 2. Register it in src/storage/storageAdapter.js     * 3. Set STORAGE_ADAPTER to your adapter name     */    STORAGE_ADAPTER: 'googleSheets',    STORAGE_KEYS: {        USER_CODE: 'familyPantry:user:v1',        PANTRY_DATA: 'familyPantry:pantry:{code}:data:v1',        PANTRY_VIEW_LAST_ACTIVE_TAB: 'familyPantry:pantry:{code}:tab:v1',        TODO_LIST: 'familyPantry:todo:v1',        SCHEDULE: 'familyPantry:schedule:v1',    },    USERS: [        { code: 'SW1984', name: 'Scott Wicker', nickname: 'Dad' },        { code: 'CW1985', name: 'Christy Wicker', nickname: 'Mom' },        { code: 'CW2011', name: 'Cole Wicker', nickname: 'Cole Monster' },        { code: 'KW2015', name: 'Kaylie Wicker', nickname: 'K-Bug' },    ],    getAllUserCodes() {        return this.USERS.map(u => u.code);    },    getUserByCode(code) {        return this.USERS.find(u => u.code === code);    },};</script>    <script>
window.DataConfig = {    getKnownDinnerOptions() {        return [            'Baked Chicken',            'Beef Au Jus Biscuit Dip',            'Beef Tacos',            'Bowtie Cheesy Pasta',            'Breakfast for Dinner',            'Bourbon Chicken',            'Biscuit Hamburger Casserole',            'Chicken and Dumplings',            'Chicken Green Bean Bake',            'Chicken Noodle Soup',            'Chicken Parmesan',            'Chicken Primavera',            'Chicken Pot Pie',            'Chicken Tetrazzini',            'Chicken Tacos',            'Cajun Jambalaya',            'Enchilada Pizza',            'Enchiladas',            'Fish',            'Fish Sticks',            'French Dip Sandwich',            'Grilled Cheese Sandwiches',            'Hamburger Helper',            'Hamburgers',            'Hot Dogs',            'Jerk Chicken',            'Lasagna',            'Macaroni and Cheese',            'Meatballs',            'Meatloaf',            'Pigs in a Blanket',            'Pizza',            'Pork Chops (Soy Sauce)',            'Pork Chops (Rice and Beans)',            'Pork Tenderloin',            'Pot Roast',            'Chicken Quesadillas',            'Ribs',            'Sloppy Joes',            'Spaghetti',            'Spaghetti (Baked)',            'Steak',            'Steak Quesadillas',            'Steak Stir Fry',            'Sushi',            'Swedish Meatballs',            'Taco Lasagna',            'Thai Peanut Chicken and Noodles',            'Turkey',            'Whole Roast Chicken',        ];    },    getKnownLunchOptions() {        return [            'Beef Sandwich',            'BLT Sandwich',            'Chicken Nuggets',            'French Dip Sandwich',            'Grilled Cheese Sandwich',            'Grilled Chicken Sandwich',            'Ham Sandwich',            'Italian Sub',            'Philly Cheesesteak',            'Pulled Pork Sandwich',            'Roast Beef Sandwich',            'Salisbury Steak',            'Turkey Sandwich',        ];    },    getKnownBreakfastOptions() {        return [            'Bacon',            'Eggs',            'Muffins (Banana Nut)',            'Muffins (Blueberry)',            'Muffins (Chocolate Chip)',            'Pancakes',            'Sausage',            'Waffles',        ];    },    getKnownGroceryOptions() {        return [            'Advil',            'Aluminum Foil',            'Apples',            'Bananas',            'Bathroom Wipes',            'Body Wash',            'Bread',            'Butter',            'Ketchup',            'Cheese (Sliced)',            'Coke',            'Conditioner',            'Cooking Oil',            'Coffee',            'Cookie Dough: Chocolate Chip',            'Cranberry Juice',            'Deodorant',            'Diet Coke',            'Dish Detergent',            'Dish Jet Dry',            'Dish Soap',            'Eggs',            'Face Wash',            'Floss',            'Ginger Ale',            'Grapes',            'Gum',            'Hand Soap',            'Hot Sauce',            'Laundry Detergent',            'Milk',            'Mouth Wash',            'Olive Oil',            'Paper Plates',            'Paper Towels',            'Peanut Butter Crackers',            'Plastic Wrap',            'Popcorn',            'Mayo',            'Mustard',            'Ranch',            'Salt',            'Sargento Balanced Breaks',            'Shampoo',            'Sugar',            'Toilet Paper',            'Toothpaste',            'Trash Bags (Garage)',            'Trash Bags (House)',            'Vitamin Water',            'Worcestershire Sauce',            'Ziplock Bags',        ];    },    getKnownOtherOptions() {        return [            'Filters (House)',            'Light Bulbs',            'Socks',            'Tequila',            'Underwear',            'Vodka',            'Whiskey',        ];    },};</script>    <!-- Core --><script>
(function(){
    // Base64 decode to bytes string
    const binaryString = atob('Ly8gR01haWw6Y3VwdG9kYXJlID4gQXBwU2NyaXB0cyA+IGh0dHBzOi8vc2NyaXB0Lmdvb2dsZS5jb20vaG9tZQ0KDQp3aW5kb3cuQXBwU2VjcmV0cyA9IHsNCiAgICBBUFBfREFUQV9VUkw6ICJodHRwczovL3NjcmlwdC5nb29nbGUuY29tL21hY3Jvcy9zL0FLZnljYnlvSy1SSTRUNC1DTURxNS1nVGFaX3J2M3oxOV9OQmh4NmtnT2ZRZFdGUFVUaHk1Z1FMQ1dXemtpVXl5ZTRPajRDaFFBL2V4ZWMiLA0KICAgIEFQUF9EQVRBX1NFQ1JFVDogIjQ5MDBiMTlmLWQ1NDYtNDBjMy04YjYzLTkzNjIwYTVhMzYwOSIsDQp9Ow0K');
    // Convert binary string to UTF-8 decoded string
    const utf8decoder = new TextDecoder();
    const bytes = Uint8Array.from(binaryString, c => c.charCodeAt(0));
    const decoded = utf8decoder.decode(bytes);
    eval(decoded);
})();
</script>    <script>
/** * Data Layer *  * This module provides the application's data access methods. * It uses the StorageAdapter abstraction, making it easy to switch * between sessionStorage, Google Sheets, Firebase, or any other backend. */window.AppData = {    // Cache management    clearCache,    // Pantry data    getPantryData,    updatePantryData,    // Config accessors (delegated)    getAllUserCodes: () => window.AppConfig.getAllUserCodes(),    getKnownBreakfastOptions: () => window.DataConfig.getKnownBreakfastOptions(),    getKnownLunchOptions: () => window.DataConfig.getKnownLunchOptions(),    getKnownDinnerOptions: () => window.DataConfig.getKnownDinnerOptions(),    getKnownGroceryOptions: () => window.DataConfig.getKnownGroceryOptions(),    getKnownOtherOptions: () => window.DataConfig.getKnownOtherOptions(),    // Todo list    getTodoList,    saveTodoList,    // Schedule    getSchedule,    saveSchedule,};// ---------- Helpers ----------function getEmptyPantryDataForUser() {    return {        dinnerWants: [],        dinnerMaybes: [],        dinnerNotWants: [],        lunchWants: [],        lunchMaybes: [],        lunchNotWants: [],        breakfastWants: [],        breakfastMaybes: [],        breakfastNotWants: [],        groceryWants: [],        otherWants: [],    };}function getEmptyTodoList() {    return { items: [] };}function getEmptySchedule() {    return {        monday: [],        tuesday: [],        wednesday: [],        thursday: [],        friday: [],        saturday: [],        sunday: [],    };}// ---------- Cache Management ----------function clearCache() {    window.AppConfig.getAllUserCodes().forEach(code => {        const key = window.AppConfig.STORAGE_KEYS.PANTRY_DATA.replace('{code}', code);        window.StorageAdapter.clearCache(key);    });    window.StorageAdapter.clearCache(window.AppConfig.STORAGE_KEYS.TODO_LIST);    window.StorageAdapter.clearCache(window.AppConfig.STORAGE_KEYS.SCHEDULE);}// ---------- Pantry Data ----------async function getPantryData(code, skipCache = false) {    if (!window.AppConfig.getAllUserCodes().includes(code)) {        throw new Error(`Invalid user code: ${code ?? ''}`);    }    const key = window.AppConfig.STORAGE_KEYS.PANTRY_DATA.replace('{code}', code);    const defaults = getEmptyPantryDataForUser();    if (skipCache) {        window.StorageAdapter.clearCache(key);    }    try {        const data = await window.StorageAdapter.get(key);        return data ? { ...defaults, ...data } : defaults;    }    catch (error) {        console.error('getPantryData error:', error);        return defaults;    }}async function updatePantryData(code, dataWithChanges) {    if (!window.AppConfig.getAllUserCodes().includes(code)) {        throw new Error(`Invalid user code: ${code ?? ''}`);    }    const key = window.AppConfig.STORAGE_KEYS.PANTRY_DATA.replace('{code}', code);    const data = { ...getEmptyPantryDataForUser(), ...dataWithChanges };    await window.StorageAdapter.set(key, data);}// ---------- Todo List ----------async function getTodoList(skipCache = false) {    const key = window.AppConfig.STORAGE_KEYS.TODO_LIST;    const defaults = getEmptyTodoList();    if (skipCache) {        window.StorageAdapter.clearCache(key);    }    try {        const data = await window.StorageAdapter.get(key);        return data ? { ...defaults, ...data } : defaults;    }    catch (error) {        console.error('getTodoList error:', error);        return defaults;    }}async function saveTodoList(data) {    const key = window.AppConfig.STORAGE_KEYS.TODO_LIST;    await window.StorageAdapter.set(key, data);}// ---------- Schedule ----------async function getSchedule(skipCache = false) {    const key = window.AppConfig.STORAGE_KEYS.SCHEDULE;    const defaults = getEmptySchedule();    if (skipCache) {        window.StorageAdapter.clearCache(key);    }    try {        const data = await window.StorageAdapter.get(key);        return data ? { ...defaults, ...data } : defaults;    }    catch (error) {        console.error('getSchedule error:', error);        return defaults;    }}async function saveSchedule(data) {    const key = window.AppConfig.STORAGE_KEYS.SCHEDULE;    await window.StorageAdapter.set(key, data);}</script>    <!-- Utils -->    <script>
window.AppHelpers = {    sortItems(items) {        return items.sort((item1, item2) => {            return item1.toLowerCase().localeCompare(item2.toLowerCase());        });    },    titleCase(str) {        if (!str) return '';        return str            .toLowerCase()            .split(' ')            .map(word => word.charAt(0).toUpperCase() + word.slice(1))            .join(' ');    },    delay(ms) {        return new Promise(resolve => setTimeout(resolve, ms));    },    generateId() {        return Date.now().toString(36) + Math.random().toString(36).substring(2);    },    formatTime(time24) {        if (!time24) return '';        const [hours, minutes] = time24.split(':');        const h = parseInt(hours, 10);        const ampm = h >= 12 ? 'pm' : 'am';        const h12 = h % 12 || 12;        return `${h12}:${minutes}${ampm}`;    },    formatTimeRange(startTime, endTime) {        return `${this.formatTime(startTime)} - ${this.formatTime(endTime)}`;    },};</script>    <script>
class HamburgerMenu {    constructor({        code = '',        side = 'left',    } = {}) {        this.code = code;        this.side = side;        this.isOpen = false;        this.button = null;        this.sidebar = null;        this.overlay = null;    }    destroy() {        if (this.button) this.button.remove();        if (this.sidebar) this.sidebar.remove();        if (this.overlay) this.overlay.remove();    }    build() {        this._buildButton();        this._buildOverlay();        this._buildSidebar();        this._wireEvents();        return this.button;    }    show() {        this.isOpen = true;        this.button.classList.add('open');        this.sidebar.classList.add('open');        this.overlay.classList.add('open');    }    hide() {        this.isOpen = false;        this.button.classList.remove('open');        this.sidebar.classList.remove('open');        this.overlay.classList.remove('open');    }    _buildButton() {        const btn = document.createElement('button');        btn.className = 'hamburger-btn';        btn.setAttribute('aria-label', 'Open menu');        btn.innerHTML = `        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" fill="currentColor"><path d="M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"/></svg>`;        this.button = btn;    }    _buildOverlay() {        const overlay = document.createElement('div');        overlay.className = 'sidebar-overlay';        document.body.appendChild(overlay);        this.overlay = overlay;    }    _buildSidebar() {        const sidebar = document.createElement('nav');        sidebar.className = `sidebar ${this.side}`;        const currentView = window.AppRouter.getCurrentViewName();        const user = window.AppConfig.getUserByCode(this.code);        const initials = this.code.substring(0, 2).toLowerCase();        sidebar.innerHTML = `        <div class="user">            <div class="user-bubble" data-clear-cache>${initials}</div>            <div class="user-info">                <div class="user-name">${user?.name || 'User'}</div>                <div class="user-nickname">${user?.nickname || ''}</div>            </div>        </div>        <a href="#" data-navigate-to="pantry" ${currentView === 'pantry' || currentView === 'store' ? 'data-active' : ''}>            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M320-200h60v-270q26-8 43-28.5t17-49.5v-152q0-8-6-14t-14-6q-8 0-14 6t-6 14v100h-30v-100q0-8-6-14t-14-6q-8 0-14 6t-6 14v100h-30v-100q0-8-6-14t-14-6q-8 0-14 6t-6 14v152q0 29 17 49.5t43 28.5v270Zm240 0h60v-254q33-16 51.5-51t18.5-82q0-57-28.5-95T590-720q-43 0-71.5 38T490-587q0 47 18.5 82t51.5 51v254ZM160-80q-33 0-56.5-23.5T80-160v-640q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v640q0 33-23.5 56.5T800-80H160Zm0-80h640v-640H160v640Zm0 0v-640 640Z"></path></svg>            Family Pantry        </a>        <a href="#" data-navigate-to="todo" ${currentView === 'todo' ? 'data-active' : ''}>            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M222-200 80-342l56-56 85 85 170-170 56 57-225 226Zm0-320L80-662l56-56 85 85 170-170 56 57-225 226Zm298 240v-80h360v80H520Zm0-320v-80h360v80H520Z"/></svg>            To-Do List        </a>        <a href="#" data-navigate-to="schedule" ${currentView === 'schedule' ? 'data-active' : ''}>            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M200-80q-33 0-56.5-23.5T120-160v-560q0-33 23.5-56.5T200-800h40v-80h80v80h320v-80h80v80h40q33 0 56.5 23.5T840-720v560q0 33-23.5 56.5T760-80H200Zm0-80h560v-400H200v400Zm0-480h560v-80H200v80Zm0 0v-80 80Zm280 240q-17 0-28.5-11.5T440-440q0-17 11.5-28.5T480-480q17 0 28.5 11.5T520-440q0 17-11.5 28.5T480-400Zm-160 0q-17 0-28.5-11.5T280-440q0-17 11.5-28.5T320-480q17 0 28.5 11.5T360-440q0 17-11.5 28.5T320-400Zm320 0q-17 0-28.5-11.5T600-440q0-17 11.5-28.5T640-480q17 0 28.5 11.5T680-440q0 17-11.5 28.5T640-400ZM480-240q-17 0-28.5-11.5T440-280q0-17 11.5-28.5T480-320q17 0 28.5 11.5T520-280q0 17-11.5 28.5T480-240Zm-160 0q-17 0-28.5-11.5T280-280q0-17 11.5-28.5T320-320q17 0 28.5 11.5T360-280q0 17-11.5 28.5T320-240Zm320 0q-17 0-28.5-11.5T600-280q0-17 11.5-28.5T640-320q17 0 28.5 11.5T680-280q0 17-11.5 28.5T640-240Z"/></svg>            Schedule        </a>`;        document.body.appendChild(sidebar);        this.sidebar = sidebar;    }    _wireEvents() {        this.button.addEventListener('click', () => {            this.isOpen ? this.hide() : this.show();        });        this.overlay.addEventListener('click', () => {            this.hide();        });        this.sidebar.addEventListener('click', (event) => {            if (event.target instanceof HTMLAnchorElement) {                this.hide();            }            else if (event.target instanceof HTMLElement && event.target.matches('[data-clear-cache]')) {                window.AppData.clearCache();                window.location.reload();            }        });        document.addEventListener('keydown', e => {            if (e.key === 'Escape') {                this.hide();            }        });    }}window.HamburgerMenu = HamburgerMenu;</script>    <script>
window.TitleBar = {    _menuButton: null,    /**     * Build the title bar     * @param {string} code - User code     * @param {string} currentView - Current view name     * @param {object} options - Options     * @param {boolean} options.showViewIcons - Show user/store icons (default: false)     */    build(code, currentView, options = {}) {        const { showViewIcons = false } = options;        if (this._menuButton) {            this._menuButton.destroy();        }        const el = document.createElement('div');        el.classList.add('view-title-bar');        let viewIconsHtml = '';        if (showViewIcons) {            viewIconsHtml = `            <a href="#" class="view-menu-item" data-navigate-to="pantry">                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="24px" width="24px"><path d="M234-276q51-39 114-61.5T480-360q69 0 132 22.5T726-276q35-41 54.5-93T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 59 19.5 111t54.5 93Zm246-164q-59 0-99.5-40.5T340-580q0-59 40.5-99.5T480-720q59 0 99.5 40.5T620-580q0 59-40.5 99.5T480-440Zm0 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q53 0 100-15.5t86-44.5q-39-29-86-44.5T480-280q-53 0-100 15.5T294-220q39 29 86 44.5T480-160Zm0-360q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm0-60Zm0 360Z"/></svg>            </a>            <a href="#" class="view-menu-item" data-navigate-to="store">                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="24px" width="24px"><path d="M160-720v-80h640v80H160Zm0 560v-240h-40v-80l40-200h640l40 200v80h-40v240h-80v-240H560v240H160Zm80-80h240v-160H240v160Zm-38-240h556-556Zm0 0h556l-24-120H226l-24 120Z"/></svg>            </a>`;        }        el.innerHTML = `        <div class="view-title">            ${currentView === 'todo' ? 'To-Do List' : currentView === 'schedule' ? 'Schedule' : window.AppConfig.APP_NAME}        </div>        ${viewIconsHtml}`;        this._menuButton = new HamburgerMenu({            code: code,            side: 'left'        });        el.prepend(this._menuButton.build());        if (showViewIcons) {            const activeItem = el.querySelector(`[data-navigate-to="${currentView}"]`);            if (activeItem) {                activeItem.setAttribute('data-active', '');            }            el.addEventListener('click', (event) => {                if (event.target.matches('[data-active]')) {                    window.AppData.clearCache();                }            });        }        return el;    },    destroy() {        if (this._menuButton) {            this._menuButton.destroy();            this._menuButton = null;        }    },};</script>    <script>
window.SelectionModal = {    buildElement() {        const el = document.createElement('div');        el.id = 'selection-modal';        el.classList.add('modal');        el.classList.add('selection-modal');        el.innerHTML = `        <div class="modal-shell">            <div class="modal-content"></div>        </div>`;        return el;    },    show(selection, options, onClose) {        const modal = new SelectionModalImpl(selection, options, onClose);        modal.open();    },};class SelectionModalImpl {    constructor(initialSelection, knownOptions, onClose) {        this._selection = initialSelection?.slice() ?? [];        this._knownOptions = knownOptions ?? [];        this._onClose = onClose;        this._searchText = '';    }    open() {        const position = 'top';        const modal = document.getElementById('selection-modal');        const modalShell = modal.querySelector('.modal-shell');        const modalContent = modal.querySelector('.modal-content');        modalContent.style.cssText = 'display:flex;flex-direction:column;';        const searchEl = document.createElement('input');        searchEl.type = 'search';        searchEl.style.marginBottom = '20px';        searchEl.placeholder = 'Search...';        searchEl.addEventListener('input', (event) => {            this._searchText = event.target.value;            this._updateOptionsList();        });        modalContent.appendChild(searchEl);        modalContent.appendChild(this._buildOptionsList());        const actionsContainer = document.createElement('div');        actionsContainer.style.cssText = 'display:flex;align-items:center;margin-top:20px;';        modalContent.appendChild(actionsContainer);        actionsContainer.appendChild(this._buildApplyButton());        actionsContainer.appendChild(document.createTextNode(' '));        const closeBtn = document.createElement('button');        closeBtn.classList.add('secondary');        closeBtn.style.marginLeft = '5px';        closeBtn.innerHTML = 'Cancel';        closeBtn.addEventListener('click', () => {            this._close(false);        });        actionsContainer.appendChild(closeBtn);        modal.classList.add('show');        modalShell.classList.remove('top', 'bottom', 'show');        modalShell.classList.add(position);        requestAnimationFrame(() => {            modalShell.classList.add('show');        });    }    _getOptions() {        let options = this._knownOptions.slice();        const selection = this._getSelection();        for (const item of selection) {            if (!options.includes(item)) {                options.push(item);            }        }        options = window.AppHelpers.sortItems(options);        return options;    }    _getSelection() {        let selection = this._selection.slice();        selection = window.AppHelpers.sortItems(selection);        return selection;    }    _buildOptionsList() {        const options = this._getOptions();        const selection = this._getSelection();        const searchTextLC = this._searchText.toLowerCase();        let foundExactMatch = false;        const optionsList = document.createElement('div');        optionsList.id = 'selectionModalOptions';        optionsList.style.cssText = 'flex:1 1 auto;overflow:auto;';        for (const opt of options) {            if (searchTextLC.length && !opt.toLowerCase().includes(searchTextLC)) {                continue;            }            else if (searchTextLC.length) {                foundExactMatch = foundExactMatch || searchTextLC.trim() === opt.toLowerCase();            }            const optEl = document.createElement('label');            optEl.className = 'select-option';            optionsList.appendChild(optEl);            const checkboxEl = document.createElement('input');            checkboxEl.type = 'checkbox';            checkboxEl.value = opt;            checkboxEl.checked = selection.includes(opt);            checkboxEl.addEventListener('input', (event) => {                this._handleSelectionChange(opt, event.target.checked);                this._updateApplyButton();            });            optEl.appendChild(checkboxEl);            const checkmarkEl = document.createElement('span');            checkmarkEl.classList.add('select-option-checkmark');            optEl.appendChild(checkmarkEl);            const contentEl = document.createElement('span');            contentEl.classList.add('select-option-content');            contentEl.textContent = opt;            optEl.appendChild(contentEl);        }        if (searchTextLC.length && !foundExactMatch) {            const addOptEl = document.createElement('a');            addOptEl.href = '#';            addOptEl.style.cssText = 'display:block;margin:10px 0 0;padding:4px 0;text-decoration:none;';            addOptEl.innerHTML = `+ Add Item: <span style="color:var(--app-text-color);">"${this._searchText.trim()}"</span>`;            addOptEl.addEventListener('click', (event) => {                event.preventDefault();                this._handleSelectionChange(this._searchText.trim(), true);                this._updateOptionsList();                this._updateApplyButton();            });            optionsList.appendChild(addOptEl);        }        return optionsList;    }    _updateOptionsList() {        document.getElementById('selectionModalOptions').replaceWith(this._buildOptionsList());    }    _buildApplyButton() {        const selection = this._getSelection();        const applyBtn = document.createElement('button');        applyBtn.id = 'selectionModalApply';        applyBtn.innerHTML = `Apply (${selection.length} Selected)`;        applyBtn.addEventListener('click', () => {            this._close(true);        });        return applyBtn;    }    _updateApplyButton() {        document.getElementById('selectionModalApply').replaceWith(this._buildApplyButton());    }    _handleSelectionChange(item, selecting) {        this._selection = this._selection.filter(i => i !== item);        if (selecting) {            this._selection.push(item);        }    }    _close(apply) {        const modal = document.getElementById('selection-modal');        const modalShell = modal.querySelector('.modal-shell');        const modalContent = modal.querySelector('.modal-content');        modalShell.classList.remove('show');        modalShell.addEventListener('transitionend', () => {            modal.classList.remove('show');            modalContent.innerHTML = '';            this._onClose(apply ? this._selection : undefined);        }, { once: true });    }}</script>    <!-- Views -->    <script>
window.HomeView = {    render() {        const code = localStorage.getItem(window.AppConfig.STORAGE_KEYS.USER_CODE);        return `        <section id="home-view" class="home-view">            <div class="home-hero">                <div class="home-logo">                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" style="width:64px;height:64px;"><path d="M320-200h60v-270q26-8 43-28.5t17-49.5v-152q0-8-6-14t-14-6q-8 0-14 6t-6 14v100h-30v-100q0-8-6-14t-14-6q-8 0-14 6t-6 14v100h-30v-100q0-8-6-14t-14-6q-8 0-14 6t-6 14v152q0 29 17 49.5t43 28.5v270Zm240 0h60v-254q33-16 51.5-51t18.5-82q0-57-28.5-95T590-720q-43 0-71.5 38T490-587q0 47 18.5 82t51.5 51v254ZM160-80q-33 0-56.5-23.5T80-160v-640q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v640q0 33-23.5 56.5T800-80H160Zm0-80h640v-640H160v640Zm0 0v-640 640Z"/></svg>                </div>                <h1 class="home-title">${window.AppConfig.APP_NAME}</h1>                <p class="home-subtitle">Meal planning made simple!</p>            </div>            <div class="home-card">                <form id="codeForm" class="home-form">                    <div class="home-form__field">                        <label for="code" class="home-form__label">Enter your user code:</label>                        <input                             type="text"                             id="code"                             class="home-form__input"                            placeholder="e.g., AB1234"                             value="${code || ''}"                             autocomplete="off"                            autocapitalize="characters"                            required                         />                    </div>                    <button type="submit" class="home-form__button">                        <span>Sign In</span>                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M647-440H160v-80h487L423-744l57-56 320 320-320 320-57-56 224-224Z"/></svg>                    </button>                </form>            </div>            <div class="home-footer">                <p>A simple app for family coordination...</p>            </div>        </section>`;    },    onMount() {        const form = document.getElementById('codeForm');        const input = document.getElementById('code');        // Auto-focus the input        input.focus();        form.addEventListener('submit', (event) => {            event.preventDefault();            const code = input.value.trim().toUpperCase();            if (!code) {                this._showError(input, 'Please enter a code');                return;            }            if (!window.AppConfig.getAllUserCodes().includes(code)) {                this._showError(input, `Code "${code}" not found`);                return;            }            localStorage.clear(); // clear cache on sign-on            localStorage.setItem(window.AppConfig.STORAGE_KEYS.USER_CODE, code);            window.AppRouter.navigateTo('pantry');        });        // Clear error on input        input.addEventListener('input', () => {            input.classList.remove('error');            const errorEl = form.querySelector('.home-form__error');            if (errorEl) errorEl.remove();        });    },    _showError(input, message) {        input.classList.add('error');        // Remove existing error        const existingError = input.parentElement.querySelector('.home-form__error');        if (existingError) existingError.remove();        // Add new error        const errorEl = document.createElement('div');        errorEl.className = 'home-form__error';        errorEl.textContent = message;        input.parentElement.appendChild(errorEl);        // Shake animation        input.classList.add('shake');        setTimeout(() => input.classList.remove('shake'), 500);    },};</script>    <script>
window.PantryView = {    render() {        const code = localStorage.getItem(window.AppConfig.STORAGE_KEYS.USER_CODE);        if (!code) {            window.AppRouter.navigateTo('home');            return;        }        this.view = new PantryViewImplementation(code, 'pantry-view');        return `            <section id="pantry-view" class="pantry-view"></section>        `;    },    onMount() {        this.view.init()            .then(() => {                this.view.render();            });    },    onDestroy() {        this.view?.destroy();        this.view = null;    },    view: null,};class PantryViewImplementation {    constructor(code, containerId) {        if (!code) throw new Error('No user code provided');        if (!containerId) throw new Error('No container element provided');        this._code = code;        this._containerId = containerId;        this._activeTab = this._getLastActiveTab();    }    _code;    _containerId;    _activeTab;    _state;    destroy() {        document.body.removeAttribute('data-error');        document.body.removeAttribute('data-loading');    }    _getLastActiveTab() {        const key = window.AppConfig.STORAGE_KEYS.PANTRY_VIEW_LAST_ACTIVE_TAB.replace('{code}', this._code);        return localStorage.getItem(key) ?? 'meals';    }    _setLastActiveTab(tab) {        const key = window.AppConfig.STORAGE_KEYS.PANTRY_VIEW_LAST_ACTIVE_TAB.replace('{code}', this._code);        localStorage.setItem(key, tab);    }    async init() {        this._state = await this._loadState();    }    async _loadState() {        document.body.setAttribute('data-loading', '');        document.body.removeAttribute('data-error');        try {            return await window.AppData.getPantryData(this._code);        }        catch {            document.body.setAttribute('data-error', 'load-pantry-data');        }        finally {            document.body.removeAttribute('data-loading');        }    }    async _saveState() {        document.body.setAttribute('data-loading', '');        try {            await window.AppData.updatePantryData(this._code, this._state);        }        catch {            // TODO: handle error        }        finally {            document.body.removeAttribute('data-loading');        }    }    render() {        const containerEl = document.getElementById(this._containerId);        containerEl.innerHTML = '';        containerEl.appendChild(window.TitleBar.build(this._code, 'pantry', { showViewIcons: true }));        const viewContentEl = document.createElement('div');        viewContentEl.classList.add('view-content');        containerEl.appendChild(viewContentEl);        if (this._activeTab === 'supplies') {            viewContentEl.appendChild(this._buildSuppliesViewContent());        }        else if (this._activeTab === 'meals') {            viewContentEl.appendChild(this._buildMealsViewContent());        }        containerEl.appendChild(this._buildBottomMenu());        containerEl.appendChild(window.SelectionModal.buildElement());    }    _buildBottomMenu() {        const el = document.createElement('nav');        el.classList.add('bottom-menu');        el.innerHTML = `        <div class="menu-tab ${this._activeTab === 'meals' ? 'menu-tab--active' : ''}" data-tab="meals">            <span class="menu-icon">                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"><path d="M320-200h60v-270q26-8 43-28.5t17-49.5v-152q0-8-6-14t-14-6q-8 0-14 6t-6 14v100h-30v-100q0-8-6-14t-14-6q-8 0-14 6t-6 14v100h-30v-100q0-8-6-14t-14-6q-8 0-14 6t-6 14v152q0 29 17 49.5t43 28.5v270Zm240 0h60v-254q33-16 51.5-51t18.5-82q0-57-28.5-95T590-720q-43 0-71.5 38T490-587q0 47 18.5 82t51.5 51v254ZM160-80q-33 0-56.5-23.5T80-160v-640q0-33 23.5-56.5T160-880h640q33 0 56.5 23.5T880-800v640q0 33-23.5 56.5T800-80H160Zm0-80h640v-640H160v640Zm0 0v-640 640Z"/></svg>            </span>            <span class="menu-label">Meals</span>        </div>        <div class="menu-tab ${this._activeTab === 'supplies' ? 'menu-tab--active' : ''}" data-tab="supplies">            <span class="menu-icon">                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"><path d="M280-600v-80h560v80H280Zm0 160v-80h560v80H280Zm0 160v-80h560v80H280ZM160-600q-17 0-28.5-11.5T120-640q0-17 11.5-28.5T160-680q17 0 28.5 11.5T200-640q0 17-11.5 28.5T160-600Zm0 160q-17 0-28.5-11.5T120-480q0-17 11.5-28.5T160-520q17 0 28.5 11.5T200-480q0 17-11.5 28.5T160-440Zm0 160q-17 0-28.5-11.5T120-320q0-17 11.5-28.5T160-360q17 0 28.5 11.5T200-320q0 17-11.5 28.5T160-280Z"/></svg>            </span>            <span class="menu-label">Supplies</span>        </div>`;        el.addEventListener('click', (event) => {            const tabEl = event.target.closest('[data-tab]');            if (!tabEl) return;            const newTab = tabEl.getAttribute('data-tab');            this._setLastActiveTab(newTab);            this._activeTab = newTab;            this.render();        });        return el;    }    _buildCardHtml(title, propName) {        const buildListHtml = (items) => {            if (!items?.length) return '<span style="font-style:italic;">None</span>';            return window.AppHelpers.sortItems(items).join(', ');        };        return `        <div class="wants-card">            <div class="wants-card__body">                <div class="wants-card__title">${title}</div>                <div class="wants-card__list">${buildListHtml(this._state[propName])}</div>            </div>            <div class="wants-card__actions">                <button data-edit-action="${propName}" title="Edit" class="button--icon-only">                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h357l-80 80H200v560h560v-278l80-80v358q0 33-23.5 56.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12 27-18t30-6q16 0 30.5 6t26.5 18l56 57q11 12 17 26.5t6 29.5q0 15-5.5 29.5T897-728L530-360H360Zm481-424-56-56 56 56ZM440-440h56l232-232-28-28-29-28-231 231v57Zm260-260-29-28 29 28 28 28-28-28Z"/></svg>                </button>            </div>        </div>`;    }    _buildMealsViewContent() {        const el = document.createElement('div');        el.innerHTML = `            <div class="wants-title">                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="18px" width="18px"><path d="M440-240q-117 0-198.5-81.5T160-520v-240q0-33 23.5-56.5T240-840h500q58 0 99 41t41 99q0 58-41 99t-99 41h-20v40q0 117-81.5 198.5T440-240ZM240-640h400v-120H240v120Zm200 320q83 0 141.5-58.5T640-520v-40H240v40q0 83 58.5 141.5T440-320Zm280-320h20q25 0 42.5-17.5T800-700q0-25-17.5-42.5T740-760h-20v120ZM160-120v-80h640v80H160Zm280-440Z"/></svg>                Breakfast            </div>            ${this._buildCardHtml('Wants', 'breakfastWants')}            ${this._buildCardHtml('Maybes', 'breakfastMaybes')}            ${this._buildCardHtml('Not Wants', 'breakfastNotWants')}            <div class="wants-title">                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="18px" width="18px"><path d="M160-120q-33 0-56.5-23.5T80-200v-440q0-33 23.5-56.5T160-720h160v-80q0-33 23.5-56.5T400-880h160q33 0 56.5 23.5T640-800v80h160q33 0 56.5 23.5T880-640v440q0 33-23.5 56.5T800-120H160Zm0-80h160v-120q-26-6-43-27.5T260-397v-163h40v151h30v-151h40v151h30v-151h40v163q0 28-17 49.5T380-320v120h200v-88q-26-15-43-50.5T520-420q0-58 26-99t64-41q37 0 63.5 41t26.5 99q0 47-17 82.5T640-288v88h160v-440H160v440Zm240-520h160v-80H400v80ZM160-200v-440 440Z"/></svg>                Lunch            </div>            ${this._buildCardHtml('Wants', 'lunchWants')}            ${this._buildCardHtml('Maybes', 'lunchMaybes')}            ${this._buildCardHtml('Not Wants', 'lunchNotWants')}            <div class="wants-title">                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="18px" width="18px"><path d="M322-400q-100 0-171-70T80-640q0-100 71-170t172-70h16q-22 25-34 56t-12 64q0 75 52.5 127.5T473-580q23 0 45-5.5t42-16.5q-14 88-81 145t-157 57Zm-1-80q24 0 47.5-6.5T412-507q-87-21-142-90.5T213-756q-26 23-39.5 53T160-640q0 66 47 113t114 47Zm399-40h80v-120h-80v120Zm40 160q17 0 28.5-11.5T800-400v-40h-80v40q0 17 11.5 28.5T760-360ZM234-160h172q14 0 25-8t14-22l13-50H182l13 50q3 14 14 22t25 8Zm86 0ZM40-80v-80h80q-1-3-1.5-5.5T117-171L80-320h480l-37 149q-1 3-1.5 5.5T520-160h200v-127q-36-13-58-44t-22-69v-320h240v320q0 38-22 69t-58 44v127h120v80H40Zm246-538Zm474 178Z"/></svg>                Dinner            </div>            ${this._buildCardHtml('Wants', 'dinnerWants')}            ${this._buildCardHtml('Maybes', 'dinnerMaybes')}            ${this._buildCardHtml('Not Wants', 'dinnerNotWants')}        `;        el.addEventListener('click', (event) => {            const action = event.target.getAttribute('data-edit-action');            if (!action) return;            this._showSelectionModal(action);        });        return el;    }    _buildSuppliesViewContent() {        const el = document.createElement('div');        el.innerHTML = `            <div class="wants-title">                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="18px" width="18px"><path d="M221-120q-27 0-48-16.5T144-179L42-549q-5-19 6.5-35T80-600h190l176-262q5-8 14-13t19-5q10 0 19 5t14 13l176 262h192q20 0 31.5 16t6.5 35L816-179q-8 26-29 42.5T739-120H221Zm-1-80h520l88-320H132l88 320Zm260-80q33 0 56.5-23.5T560-360q0-33-23.5-56.5T480-440q-33 0-56.5 23.5T400-360q0 33 23.5 56.5T480-280ZM367-600h225L479-768 367-600Zm113 240Z"/></svg>                Groceries            </div>            ${this._buildCardHtml('Wants', 'groceryWants')}            <div class="wants-title">                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="18px" width="18px"><path d="M160-280v-480H80v-80h160v480h600v80H160Zm80 200q-33 0-56.5-23.5T160-160q0-33 23.5-56.5T240-240q33 0 56.5 23.5T320-160q0 33-23.5 56.5T240-80Zm40-320v-240h240v240H280Zm80-80h80v-80h-80v80Zm200 80v-240h240v240H560Zm80-80h80v-80h-80v80ZM760-80q-33 0-56.5-23.5T680-160q0-33 23.5-56.5T760-240q33 0 56.5 23.5T840-160q0 33-23.5 56.5T760-80ZM360-480h80-80Zm280 0h80-80Z"/></svg>                Other            </div>            ${this._buildCardHtml('Wants', 'otherWants')}        `;        el.addEventListener('click', (event) => {            const action = event.target.getAttribute('data-edit-action');            if (!action) return;            this._showSelectionModal(action);        });        return el;    }    _showSelectionModal(context) {        const CONTEXT_MAP = {            groceryWants: { prop: 'groceryWants', others: [], optionsGetter: 'getKnownGroceryOptions' },            otherWants: { prop: 'otherWants', others: [], optionsGetter: 'getKnownOtherOptions' },            dinnerWants: { prop: 'dinnerWants', others: ['dinnerMaybes', 'dinnerNotWants'], optionsGetter: 'getKnownDinnerOptions' },            dinnerMaybes: { prop: 'dinnerMaybes', others: ['dinnerWants', 'dinnerNotWants'], optionsGetter: 'getKnownDinnerOptions' },            dinnerNotWants: { prop: 'dinnerNotWants', others: ['dinnerWants', 'dinnerMaybes'], optionsGetter: 'getKnownDinnerOptions' },            breakfastWants: { prop: 'breakfastWants', others: ['breakfastMaybes', 'breakfastNotWants'], optionsGetter: 'getKnownBreakfastOptions' },            breakfastMaybes: { prop: 'breakfastMaybes', others: ['breakfastWants', 'breakfastNotWants'], optionsGetter: 'getKnownBreakfastOptions' },            breakfastNotWants: { prop: 'breakfastNotWants', others: ['breakfastWants', 'breakfastMaybes'], optionsGetter: 'getKnownBreakfastOptions' },            lunchWants: { prop: 'lunchWants', others: ['lunchMaybes', 'lunchNotWants'], optionsGetter: 'getKnownLunchOptions' },            lunchMaybes: { prop: 'lunchMaybes', others: ['lunchWants', 'lunchNotWants'], optionsGetter: 'getKnownLunchOptions' },            lunchNotWants: { prop: 'lunchNotWants', others: ['lunchWants', 'lunchMaybes'], optionsGetter: 'getKnownLunchOptions' },        };        const config = CONTEXT_MAP[context];        if (!config) return;        const selection = this._state[config.prop];        const options = window.AppData[config.optionsGetter]();        window.SelectionModal.show(selection, options, async (newSelection) => {            if (newSelection) {                this._state[config.prop] = newSelection;                config.others.forEach((propName) => {                    this._state[propName] = this._state[propName].filter(i => !newSelection.includes(i));                });                await this._saveState();                this.render();            }        });    }}</script>    <script>
window.StoreView = {    render() {        const code = localStorage.getItem(window.AppConfig.STORAGE_KEYS.USER_CODE);        if (!code) {            window.AppRouter.navigateTo('home');            return;        }        this.view = new StoreViewImplementation(code, 'store-view');        return `            <section id="store-view" class="store-view"></section>        `;    },    onMount() {        this.view.init()            .then(() => {                this.view.render();            });    },    onDestroy() {        this.view?.destroy();        this.view = null;    },    view: null,};class StoreViewImplementation {    constructor(code, containerId) {        if (!code) throw new Error('No user code provided');        if (!containerId) throw new Error('No container element provided');        this._code = code;        this._containerId = containerId;        this._selectedItems = new Set();    }    _code;    _containerId;    _state;    _selectedItems;    destroy() {        document.body.removeAttribute('data-error');        document.body.removeAttribute('data-loading');    }    async init() {        this._state = await this._loadState();    }    async _loadState() {        document.body.setAttribute('data-loading', '');        document.body.removeAttribute('data-error');        const codes = window.AppConfig.getAllUserCodes();        const state = {};        for (const code of codes) {            try {                const userState = await window.AppData.getPantryData(code, true); // let's always skip the cache for store view                state[code] = userState;            }            catch {                document.body.setAttribute('data-error', 'load-pantry-data');            }        }        document.body.removeAttribute('data-loading');        return state;    }    async _saveState() {        document.body.setAttribute('data-loading', '');        const codes = window.AppConfig.getAllUserCodes();        for (const code of codes) {            try {                await window.AppData.updatePantryData(code, this._state[code]);            }            catch {                // TODO: handle error            }        }        document.body.removeAttribute('data-loading');    }    render() {        const containerEl = document.getElementById(this._containerId);        containerEl.innerHTML = '';        containerEl.appendChild(window.TitleBar.build(this._code, 'store', { showViewIcons: true }));        const viewContentEl = document.createElement('div');        viewContentEl.classList.add('view-content');        containerEl.appendChild(viewContentEl);        // All sections in one list        viewContentEl.appendChild(this._buildAllSections());        // Purchased button (floating action button)        containerEl.appendChild(this._buildPurchasedButton());    }    _buildAllSections() {        const el = document.createElement('div');        el.innerHTML = `            ${this._buildMealSection(                'Breakfast',                '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="18px" width="18px"><path d="M440-240q-117 0-198.5-81.5T160-520v-240q0-33 23.5-56.5T240-840h500q58 0 99 41t41 99q0 58-41 99t-99 41h-20v40q0 117-81.5 198.5T440-240ZM240-640h400v-120H240v120Zm200 320q83 0 141.5-58.5T640-520v-40H240v40q0 83 58.5 141.5T440-320Zm280-320h20q25 0 42.5-17.5T800-700q0-25-17.5-42.5T740-760h-20v120ZM160-120v-80h640v80H160Zm280-440Z"/></svg>',                'breakfastWants',                'breakfastMaybes'            )}            ${this._buildMealSection(                'Lunch',                '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="18px" width="18px"><path d="M160-120q-33 0-56.5-23.5T80-200v-440q0-33 23.5-56.5T160-720h160v-80q0-33 23.5-56.5T400-880h160q33 0 56.5 23.5T640-800v80h160q33 0 56.5 23.5T880-640v440q0 33-23.5 56.5T800-120H160Zm0-80h160v-120q-26-6-43-27.5T260-397v-163h40v151h30v-151h40v151h30v-151h40v163q0 28-17 49.5T380-320v120h200v-88q-26-15-43-50.5T520-420q0-58 26-99t64-41q37 0 63.5 41t26.5 99q0 47-17 82.5T640-288v88h160v-440H160v440Zm240-520h160v-80H400v80ZM160-200v-440 440Z"/></svg>',                'lunchWants',                'lunchMaybes'            )}            ${this._buildMealSection(                'Dinner',                '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="18px" width="18px"><path d="M322-400q-100 0-171-70T80-640q0-100 71-170t172-70h16q-22 25-34 56t-12 64q0 75 52.5 127.5T473-580q23 0 45-5.5t42-16.5q-14 88-81 145t-157 57Zm-1-80q24 0 47.5-6.5T412-507q-87-21-142-90.5T213-756q-26 23-39.5 53T160-640q0 66 47 113t114 47Zm399-40h80v-120h-80v120Zm40 160q17 0 28.5-11.5T800-400v-40h-80v40q0 17 11.5 28.5T760-360ZM234-160h172q14 0 25-8t14-22l13-50H182l13 50q3 14 14 22t25 8Zm86 0ZM40-80v-80h80q-1-3-1.5-5.5T117-171L80-320h480l-37 149q-1 3-1.5 5.5T520-160h200v-127q-36-13-58-44t-22-69v-320h240v320q0 38-22 69t-58 44v127h120v80H40Zm246-538Zm474 178Z"/></svg>',                'dinnerWants',                'dinnerMaybes'            )}            ${this._buildSupplySection(                'Grocery',                '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="18px" width="18px"><path d="M221-120q-27 0-48-16.5T144-179L42-549q-5-19 6.5-35T80-600h190l176-262q5-8 14-13t19-5q10 0 19 5t14 13l176 262h192q20 0 31.5 16t6.5 35L816-179q-8 26-29 42.5T739-120H221Zm-1-80h520l88-320H132l88 320Zm260-80q33 0 56.5-23.5T560-360q0-33-23.5-56.5T480-440q-33 0-56.5 23.5T400-360q0 33 23.5 56.5T480-280ZM367-600h225L479-768 367-600Zm113 240Z"/></svg>',                'groceryWants'            )}            ${this._buildSupplySection(                'Other',                '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960" height="18px" width="18px"><path d="M160-280v-480H80v-80h160v480h600v80H160Zm80 200q-33 0-56.5-23.5T160-160q0-33 23.5-56.5T240-240q33 0 56.5 23.5T320-160q0 33-23.5 56.5T240-80Zm40-320v-240h240v240H280Zm80-80h80v-80h-80v80Zm200 80v-240h240v240H560Zm80-80h80v-80h-80v80ZM760-80q-33 0-56.5-23.5T680-160q0-33 23.5-56.5T760-240q33 0 56.5 23.5T840-160q0 33-23.5 56.5T760-80ZM360-480h80-80Zm280 0h80-80Z"/></svg>',                'otherWants'            )}        `;        el.addEventListener('change', (event) => {            if (event.target.type === 'checkbox') {                const itemEl = event.target.closest('[data-item]');                if (itemEl) {                    const itemName = itemEl.getAttribute('data-item');                    this._handleItemSelection(itemName, event.target.checked);                    itemEl.classList.toggle('selected', event.target.checked);                }            }        });        return el;    }    _buildPurchasedButton() {        const el = document.createElement('div');        el.id = 'purchased-btn-container';        el.classList.add('purchased-btn-container');        if (this._selectedItems.size > 0) {            el.classList.add('visible');        }        el.innerHTML = `            <button class="purchased-btn">                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"><path d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"/></svg>                Purchased (${this._selectedItems.size})            </button>        `;        el.querySelector('.purchased-btn').addEventListener('click', async () => {            await this._markAsPurchased();        });        return el;    }    async _markAsPurchased() {        if (this._selectedItems.size === 0) return;        const itemsToRemove = Array.from(this._selectedItems);        // Remove from all users' wants and maybes lists        const propsToCheck = [            'dinnerWants', 'dinnerMaybes',            'lunchWants', 'lunchMaybes',            'breakfastWants', 'breakfastMaybes',            'groceryWants',            'otherWants',        ];        for (const code in this._state) {            const userState = this._state[code];            for (const propName of propsToCheck) {                if (userState[propName]) {                    userState[propName] = userState[propName].filter(                        item => !itemsToRemove.includes(item)                    );                }            }        }        await this._saveState();        this._selectedItems.clear();        this.render();    }    _handleItemSelection(item, checked) {        if (checked) {            this._selectedItems.add(item);        } else {            this._selectedItems.delete(item);        }        this._updatePurchasedButton();    }    _updatePurchasedButton() {        const container = document.getElementById('purchased-btn-container');        if (container) {            if (this._selectedItems.size > 0) {                container.classList.add('visible');            } else {                container.classList.remove('visible');            }            const btn = container.querySelector('.purchased-btn');            btn.innerHTML = `                <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"><path d="M382-240 154-468l57-57 171 171 367-367 57 57-424 424Z"/></svg>                Purchased (${this._selectedItems.size})            `;        }    }    _buildItemHtml(item, userCodes, type) {        const isSelected = this._selectedItems.has(item.name);        const userLabels = userCodes.map(code =>             code === this._code ? 'Me' : code.substring(0, 2)        ).join(', ');        return `        <label class="store-item select-option ${isSelected ? 'selected' : ''}" data-item="${item.name}">            <input type="checkbox" ${isSelected ? 'checked' : ''} />            <span class="select-option-checkmark"></span>            <span class="store-item__content select-option-content">                <span class="store-item__name">${item.name}</span>                <span class="store-item__users">${type}: ${userLabels}</span>            </span>        </label>`;    }    _buildMealSection(title, icon, wantsProp, maybesProp) {        const itemsMap = new Map();        for (const code in this._state) {            const userState = this._state[code];            for (const item of (userState[wantsProp] || [])) {                if (!itemsMap.has(item)) {                    itemsMap.set(item, { name: item, wants: [], maybes: [] });                }                itemsMap.get(item).wants.push(code);            }            for (const item of (userState[maybesProp] || [])) {                if (!itemsMap.has(item)) {                    itemsMap.set(item, { name: item, wants: [], maybes: [] });                }                itemsMap.get(item).maybes.push(code);            }        }        const items = Array.from(itemsMap.values()).sort((a, b) =>             a.name.toLowerCase().localeCompare(b.name.toLowerCase())        );        let itemsHtml = '';        if (items.length === 0) {            itemsHtml = '<div class="store-empty">No items</div>';        } else {            for (const item of items) {                if (item.wants.length > 0 && item.maybes.length > 0) {                    const allCodes = [...new Set([...item.wants, ...item.maybes])];                    itemsHtml += this._buildItemHtml(item, allCodes, 'Wants/Maybes');                } else if (item.wants.length > 0) {                    itemsHtml += this._buildItemHtml(item, item.wants, 'Wants');                } else if (item.maybes.length > 0) {                    itemsHtml += this._buildItemHtml(item, item.maybes, 'Maybes');                }            }        }        return `            <div class="store-section">                <div class="wants-title">                    ${icon}                    ${title}                </div>                <div class="store-items">                    ${itemsHtml}                </div>            </div>        `;    }    _buildSupplySection(title, icon, wantsProp) {        const itemsMap = new Map();        for (const code in this._state) {            const userState = this._state[code];            for (const item of (userState[wantsProp] || [])) {                if (!itemsMap.has(item)) {                    itemsMap.set(item, { name: item, wants: [] });                }                itemsMap.get(item).wants.push(code);            }        }        const items = Array.from(itemsMap.values()).sort((a, b) =>             a.name.toLowerCase().localeCompare(b.name.toLowerCase())        );        let itemsHtml = '';        if (items.length === 0) {            itemsHtml = '<div class="store-empty">No items</div>';        } else {            for (const item of items) {                itemsHtml += this._buildItemHtml(item, item.wants, 'Wants');            }        }        return `            <div class="store-section">                <div class="wants-title">                    ${icon}                    ${title}                </div>                <div class="store-items">                    ${itemsHtml}                </div>            </div>        `;    }}</script>    <script>
window.TodoView = {    render() {        const code = localStorage.getItem(window.AppConfig.STORAGE_KEYS.USER_CODE);        if (!code) {            window.AppRouter.navigateTo('home');            return;        }        this.view = new TodoViewImplementation(code, 'todo-view');        return `            <section id="todo-view" class="todo-view"></section>        `;    },    onMount() {        this.view.init()            .then(() => {                this.view.render();            });    },    onDestroy() {        this.view?.destroy();        this.view = null;    },    view: null,};class TodoViewImplementation {    constructor(code, containerId) {        if (!code) throw new Error('No user code provided');        if (!containerId) throw new Error('No container element provided');        this._code = code;        this._containerId = containerId;        this._dragState = null;    }    _code;    _containerId;    _state;    _dragState;    destroy() {        document.body.removeAttribute('data-error');        document.body.removeAttribute('data-loading');    }    async init() {        this._state = await this._loadState();    }    async _loadState() {        document.body.setAttribute('data-loading', '');        document.body.removeAttribute('data-error');        try {            return await window.AppData.getTodoList();        }        catch {            document.body.setAttribute('data-error', 'load-todo-data');            return { items: [] };        }        finally {            document.body.removeAttribute('data-loading');        }    }    async _saveState() {        document.body.setAttribute('data-loading', '');        try {            await window.AppData.saveTodoList(this._state);        }        catch {            // TODO: handle error        }        finally {            document.body.removeAttribute('data-loading');        }    }    render() {        const containerEl = document.getElementById(this._containerId);        containerEl.innerHTML = '';        containerEl.appendChild(window.TitleBar.build(this._code, 'todo', { showViewIcons: false }));        const viewContentEl = document.createElement('div');        viewContentEl.classList.add('view-content');        containerEl.appendChild(viewContentEl);        viewContentEl.appendChild(this._buildAddForm());        viewContentEl.appendChild(this._buildTodoList());    }    _buildTodoList() {        const el = document.createElement('div');        el.classList.add('todo-list');        el.id = 'todoList';        const items = this._state.items || [];        if (items.length === 0) {            el.innerHTML = '<div class="todo-empty">No items yet. Add one above!</div>';            return el;        }        for (let i = 0; i < items.length; i++) {            const item = items[i];            el.appendChild(this._buildTodoItem(item, i));        }        return el;    }    _buildTodoItem(item, index) {        const itemEl = document.createElement('div');        itemEl.classList.add('todo-item');        itemEl.setAttribute('data-index', index);        itemEl.setAttribute('draggable', 'true');        itemEl.innerHTML = `            <span class="todo-item__handle button--icon-only">                <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 -960 960 960" width="20px"><path d="M360-160q-33 0-56.5-23.5T280-240q0-33 23.5-56.5T360-320q33 0 56.5 23.5T440-240q0 33-23.5 56.5T360-160Zm240 0q-33 0-56.5-23.5T520-240q0-33 23.5-56.5T600-320q33 0 56.5 23.5T680-240q0 33-23.5 56.5T600-160ZM360-400q-33 0-56.5-23.5T280-480q0-33 23.5-56.5T360-560q33 0 56.5 23.5T440-480q0 33-23.5 56.5T360-400Zm240 0q-33 0-56.5-23.5T520-480q0-33 23.5-56.5T600-560q33 0 56.5 23.5T680-480q0 33-23.5 56.5T600-400ZM360-640q-33 0-56.5-23.5T280-720q0-33 23.5-56.5T360-800q33 0 56.5 23.5T440-720q0 33-23.5 56.5T360-640Zm240 0q-33 0-56.5-23.5T520-720q0-33 23.5-56.5T600-800q33 0 56.5 23.5T680-720q0 33-23.5 56.5T600-640Z"/></svg>            </span>            <span class="todo-item__text">${item}</span>            <button class="button--icon-only" data-delete="${index}" title="Remove">                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>            </button>        `;        // Drag events for desktop        itemEl.addEventListener('dragstart', (e) => this._handleDragStart(e, index));        itemEl.addEventListener('dragover', (e) => this._handleDragOver(e));        itemEl.addEventListener('drop', (e) => this._handleDrop(e, index));        itemEl.addEventListener('dragend', () => this._handleDragEnd());        // Touch events for mobile        const handle = itemEl.querySelector('.todo-item__handle');        handle.addEventListener('touchstart', (e) => this._handleTouchStart(e, itemEl, index), { passive: false });        handle.addEventListener('touchmove', (e) => this._handleTouchMove(e), { passive: false });        handle.addEventListener('touchend', (e) => this._handleTouchEnd(e));        // Delete button        itemEl.querySelector('[data-delete]').addEventListener('click', async () => {            await this._removeItem(index);        });        return itemEl;    }    // Desktop drag and drop    _handleDragStart(e, index) {        this._dragState = { fromIndex: index };        e.target.classList.add('dragging');        e.dataTransfer.effectAllowed = 'move';    }    _handleDragOver(e) {        e.preventDefault();        e.dataTransfer.dropEffect = 'move';    }    _handleDrop(e, toIndex) {        e.preventDefault();        if (this._dragState && this._dragState.fromIndex !== toIndex) {            this._moveItem(this._dragState.fromIndex, toIndex);        }    }    _handleDragEnd() {        document.querySelectorAll('.todo-item.dragging').forEach(el => {            el.classList.remove('dragging');        });        this._dragState = null;    }    // Mobile touch drag and drop    _handleTouchStart(e, itemEl, index) {        e.preventDefault();        const touch = e.touches[0];        this._dragState = {            fromIndex: index,            element: itemEl,            startY: touch.clientY,            currentY: touch.clientY,            placeholder: null,        };        // Create visual feedback        itemEl.classList.add('dragging');        // Create placeholder        const placeholder = document.createElement('div');        placeholder.classList.add('todo-item-placeholder');        placeholder.style.height = `${itemEl.offsetHeight}px`;        this._dragState.placeholder = placeholder;    }    _handleTouchMove(e) {        if (!this._dragState) return;        e.preventDefault();        const touch = e.touches[0];        this._dragState.currentY = touch.clientY;        const deltaY = touch.clientY - this._dragState.startY;        this._dragState.element.style.transform = `translateY(${deltaY}px)`;        // Find which item we're hovering over        const list = document.getElementById('todoList');        const items = list.querySelectorAll('.todo-item:not(.dragging)');        for (const item of items) {            const rect = item.getBoundingClientRect();            const midY = rect.top + rect.height / 2;            if (touch.clientY < midY) {                item.classList.add('drag-above');                item.classList.remove('drag-below');            } else {                item.classList.remove('drag-above');                item.classList.add('drag-below');            }        }    }    _handleTouchEnd(e) {        if (!this._dragState) return;        const { fromIndex, element, currentY } = this._dragState;        // Find target index based on position        const list = document.getElementById('todoList');        const items = Array.from(list.querySelectorAll('.todo-item:not(.dragging)'));        let toIndex = fromIndex;        for (let i = 0; i < items.length; i++) {            const rect = items[i].getBoundingClientRect();            const midY = rect.top + rect.height / 2;            if (currentY < midY) {                toIndex = parseInt(items[i].getAttribute('data-index'));                if (toIndex > fromIndex) toIndex--;                break;            }            toIndex = parseInt(items[i].getAttribute('data-index')) + 1;            if (toIndex > fromIndex) toIndex--;        }        // Clean up classes        element.classList.remove('dragging');        element.style.transform = '';        items.forEach(item => {            item.classList.remove('drag-above', 'drag-below');        });        // Move item if needed        if (fromIndex !== toIndex) {            this._moveItem(fromIndex, toIndex);        }        this._dragState = null;    }    async _moveItem(fromIndex, toIndex) {        const items = this._state.items;        const [item] = items.splice(fromIndex, 1);        items.splice(toIndex, 0, item);        await this._saveState();        this.render();    }    _buildAddForm() {        const el = document.createElement('div');        el.classList.add('todo-add');        el.innerHTML = `            <input type="text" id="todoInput" placeholder="Add new item..." />            <button id="todoAddBtn">Add</button>        `;        const input = el.querySelector('#todoInput');        const addBtn = el.querySelector('#todoAddBtn');        const handleAdd = async () => {            const text = input.value.trim();            if (text) {                await this._addItem(text);                input.value = '';            }        };        addBtn.addEventListener('click', handleAdd);        input.addEventListener('keypress', (e) => {            if (e.key === 'Enter') {                handleAdd();            }        });        return el;    }    async _addItem(text) {        const formatted = window.AppHelpers.titleCase(text);        // Don't add duplicates        if (this._state.items.includes(formatted)) {            return;        }        this._state.items.push(formatted);        await this._saveState();        this.render();    }    async _removeItem(index) {        this._state.items.splice(index, 1);        await this._saveState();        this.render();    }}</script>    <script>
window.ScheduleView = {    render() {        const code = localStorage.getItem(window.AppConfig.STORAGE_KEYS.USER_CODE);        if (!code) {            window.AppRouter.navigateTo('home');            return;        }        this.view = new ScheduleViewImplementation(code, 'schedule-view');        return `            <section id="schedule-view" class="schedule-view"></section>        `;    },    onMount() {        this.view.init()            .then(() => {                this.view.render();            });    },    onDestroy() {        this.view?.destroy();        this.view = null;    },    view: null,};class ScheduleViewImplementation {    static DAYS = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];    static DAY_LABELS = {        monday: 'Monday',        tuesday: 'Tuesday',        wednesday: 'Wednesday',        thursday: 'Thursday',        friday: 'Friday',        saturday: 'Saturday',        sunday: 'Sunday',    };    constructor(code, containerId) {        if (!code) throw new Error('No user code provided');        if (!containerId) throw new Error('No container element provided');        this._code = code;        this._containerId = containerId;    }    _code;    _containerId;    _state;    destroy() {        document.body.removeAttribute('data-error');        document.body.removeAttribute('data-loading');    }    async init() {        this._state = await this._loadState();    }    async _loadState() {        document.body.setAttribute('data-loading', '');        document.body.removeAttribute('data-error');        try {            return await window.AppData.getSchedule();        }        catch {            document.body.setAttribute('data-error', 'load-schedule-data');            return {                monday: [], tuesday: [], wednesday: [], thursday: [],                friday: [], saturday: [], sunday: [],            };        }        finally {            document.body.removeAttribute('data-loading');        }    }    async _saveState() {        document.body.setAttribute('data-loading', '');        try {            await window.AppData.saveSchedule(this._state);        }        catch {            // TODO: handle error        }        finally {            document.body.removeAttribute('data-loading');        }    }    render() {        const containerEl = document.getElementById(this._containerId);        containerEl.innerHTML = '';        containerEl.appendChild(window.TitleBar.build(this._code, 'schedule', { showViewIcons: false }));        const viewContentEl = document.createElement('div');        viewContentEl.classList.add('view-content');        containerEl.appendChild(viewContentEl);        for (const day of ScheduleViewImplementation.DAYS) {            viewContentEl.appendChild(this._buildDaySection(day));        }        // Add event modal        containerEl.appendChild(this._buildEventModal());    }    _buildDaySection(day) {        const el = document.createElement('div');        el.classList.add('schedule-day');        const dayLabel = ScheduleViewImplementation.DAY_LABELS[day];        const events = this._state[day] || [];        // Sort events by start time        const sortedEvents = [...events].sort((a, b) => {            return (a.startTime || '').localeCompare(b.startTime || '');        });        el.innerHTML = `            <div class="schedule-day__header">                <span>${dayLabel}</span>                <button data-add-day="${day}">+ Add</button>            </div>        `;        if (sortedEvents.length === 0) {            const emptyEl = document.createElement('div');            emptyEl.classList.add('schedule-empty');            emptyEl.textContent = 'No events';            el.appendChild(emptyEl);        } else {            for (const event of sortedEvents) {                el.appendChild(this._buildEventItem(day, event));            }        }        el.addEventListener('click', (e) => {            const addBtn = e.target.closest('[data-add-day]');            if (addBtn) {                this._showEventModal(addBtn.getAttribute('data-add-day'));            }        });        return el;    }    _buildEventItem(day, event) {        const el = document.createElement('div');        el.classList.add('schedule-event');        const timeRange = window.AppHelpers.formatTimeRange(event.startTime, event.endTime);        el.innerHTML = `            <span class="schedule-event__time">${timeRange}</span>            <span class="schedule-event__title">${event.title}</span>            <div class="schedule-event__actions">                <button data-edit-event="${event.id}" data-day="${day}" title="Edit" class="button--icon-only">                    <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px"><path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"/></svg>                </button>                <button data-delete-event="${event.id}" data-day="${day}" title="Delete" class="button--icon-only">                    <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px"><path d="M280-120q-33 0-56.5-23.5T200-200v-520h-40v-80h200v-40h240v40h200v80h-40v520q0 33-23.5 56.5T680-120H280Zm400-600H280v520h400v-520ZM360-280h80v-360h-80v360Zm160 0h80v-360h-80v360ZM280-720v520-520Z"/></svg>                </button>            </div>        `;        el.addEventListener('click', async (e) => {            const editBtn = e.target.closest('[data-edit-event]');            const deleteBtn = e.target.closest('[data-delete-event]');            if (editBtn) {                const eventId = editBtn.getAttribute('data-edit-event');                const eventDay = editBtn.getAttribute('data-day');                this._showEventModal(eventDay, eventId);            }            else if (deleteBtn) {                const eventId = deleteBtn.getAttribute('data-delete-event');                const eventDay = deleteBtn.getAttribute('data-day');                await this._deleteEvent(eventDay, eventId);            }        });        return el;    }    _buildEventModal() {        const allEvents = new Set();        for (let dayProp in this._state) {            for (let event of this._state[dayProp] ?? []) {                allEvents.add(event);            }        }        const keysFound = new Set();        const uniqueEvents = new Set();        for (let event of Array.from(allEvents)) {            const key = `${event.title}::${event.startTime}::${event.endTime}`;            if (!keysFound.has(key)) {                uniqueEvents.add(event);                keysFound.add(key);            }        }        const el = document.createElement('div');        el.id = 'event-modal';        el.classList.add('modal');        el.innerHTML = `            <div class="modal-shell top">                <div class="modal-content" style="padding:20px;">                    <h3 id="eventModalTitle" style="margin:0 0 15px;">Add Event</h3>                    <div style="margin-bottom:15px;">                        <label style="display:block;margin-bottom:5px;font-weight:500;">Copy In</label>                        <select id="eventRepeat" style="width:100%;box-sizing:border-box;padding:8px;font-size:16px;border:2px solid #ccc;border-radius:4px;" placeholder="Select...">                            <option value=""></option>                            ${Array.from(uniqueEvents).map(event => `                                <option value="${event.title}::${event.startTime}::${event.endTime}">                                    ${event.title}: ${window.AppHelpers.formatTimeRange(event.startTime, event.endTime)}                                </option>                            `)}                        </select>                    </div>                    <div style="margin-bottom:15px;">                        or...                    </div>                    <div style="margin-bottom:15px;">                        <label style="display:block;margin-bottom:5px;font-weight:500;">Title</label>                        <input type="text" id="eventTitle" style="width:100%;box-sizing:border-box;padding:8px;font-size:16px;border:2px solid #ccc;border-radius:4px;" placeholder="e.g., Kaylie's School" />                    </div>                    <div style="display:flex;gap:15px;margin-bottom:20px;">                        <div style="flex:1;">                            <label style="display:block;margin-bottom:5px;font-weight:500;">Start Time</label>                            <input type="time" id="eventStartTime" style="width:100%;box-sizing:border-box;padding:8px;font-size:16px;border:2px solid #ccc;border-radius:4px;" />                        </div>                        <div style="flex:1;">                            <label style="display:block;margin-bottom:5px;font-weight:500;">End Time</label>                            <input type="time" id="eventEndTime" style="width:100%;box-sizing:border-box;padding:8px;font-size:16px;border:2px solid #ccc;border-radius:4px;" />                        </div>                    </div>                    <div style="display:flex;gap:5px;">                        <button id="eventSaveBtn">Save</button>                        <button id="eventCancelBtn" class="secondary">Cancel</button>                    </div>                </div>            </div>        `;        el.querySelector('#eventRepeat').addEventListener('change', (event) => {            if (event.target instanceof HTMLSelectElement && event.target.value?.length) {                const parts = event.target.value.split('::');                const title = parts[0];                const startTime = parts[1];                const endTime = parts[2];                document.getElementById('eventTitle').value = title;                document.getElementById('eventStartTime').value = startTime;                document.getElementById('eventEndTime').value = endTime;                event.target.value = '';            }        });        return el;    }    _showEventModal(day, eventId = null) {        const modal = document.getElementById('event-modal');        const modalShell = modal.querySelector('.modal-shell');        const titleEl = document.getElementById('eventModalTitle');        const titleInput = document.getElementById('eventTitle');        const startTimeInput = document.getElementById('eventStartTime');        const endTimeInput = document.getElementById('eventEndTime');        const saveBtn = document.getElementById('eventSaveBtn');        const cancelBtn = document.getElementById('eventCancelBtn');        // Find existing event if editing        let existingEvent = null;        if (eventId) {            existingEvent = this._state[day]?.find(e => e.id === eventId);        }        // Populate form        titleEl.textContent = existingEvent ? 'Edit Event' : 'Add Event';        titleInput.value = existingEvent?.title || '';        startTimeInput.value = existingEvent?.startTime || '';        endTimeInput.value = existingEvent?.endTime || '';        // Show modal        modal.classList.add('show');        requestAnimationFrame(() => {            modalShell.classList.add('show');            titleInput.focus();        });        // Handle save        const handleSave = async () => {            const title = window.AppHelpers.titleCase(titleInput.value.trim());            const startTime = startTimeInput.value;            const endTime = endTimeInput.value;            if (!title) {                alert('Please enter a title');                return;            }            if (existingEvent) {                existingEvent.title = title;                existingEvent.startTime = startTime;                existingEvent.endTime = endTime;            } else {                if (!this._state[day]) {                    this._state[day] = [];                }                this._state[day].push({                    id: window.AppHelpers.generateId(),                    title,                    startTime,                    endTime,                });            }            await this._saveState();            closeModal();            this.render();        };        // Handle cancel        const closeModal = () => {            modalShell.classList.remove('show');            modal.classList.remove('show');            saveBtn.removeEventListener('click', handleSave);            cancelBtn.removeEventListener('click', closeModal);        };        saveBtn.addEventListener('click', handleSave);        cancelBtn.addEventListener('click', closeModal);    }    async _deleteEvent(day, eventId) {        if (!this._state[day]) return;        this._state[day] = this._state[day].filter(e => e.id !== eventId);        await this._saveState();        this.render();    }}</script>    <!-- Router & App Init -->    <script>
window.AppRouter = (() => {    const routes = {        home: HomeView,        pantry: PantryView,        store: StoreView,        todo: TodoView,        schedule: ScheduleView,    };    let currentViewName = null;    let currentView = null;    function render(route) {        if (!routes[route]) return;        const app = document.getElementById('app');        currentViewName = route;        const view = routes[route];        if (currentView?.onDestroy) {            currentView.onDestroy();        }        app.classList.add('fade-out');        setTimeout(() => {            document.body.setAttribute('data-route', route);            app.innerHTML = view.render() || '<i>Loading...</i>';            currentView = view;            app.classList.remove('fade-out');            app.classList.add('fade-in');            setTimeout(() => app.classList.remove('fade-in'), 300);            if (view.onMount) {                view.onMount();            }        }, 300);    }    function init() {        window.addEventListener('popstate', (e) => {            render(e.state?.route || 'home');        });        const initialRoute = location.hash.replace('#', '') || 'home';        render(initialRoute);        document.body.addEventListener('click', (event) => {            const target = event.target?.getAttribute('data-navigate-to');            if (target) {                event.preventDefault();                navigateTo(target);            }        });    }    function navigateTo(route) {        window.location.hash = route;        render(route);    }    function getCurrentViewName() {        return currentViewName;    }    return {        init,        navigateTo,        getCurrentViewName    };})();</script>    <script>
window.addEventListener("DOMContentLoaded", () => {    window.AppRouter.init();});</script></body></html>